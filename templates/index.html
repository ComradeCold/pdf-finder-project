<!DOCTYPE html>
<html>
<head>
    <title>PDF Finder</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    </head>
<body id="app-body">

<div class="mode-toggle">
    <label class="switch">
        <input type="checkbox" id="mode-toggle-checkbox">
        <span class="slider"></span>
    </label>
</div>

<div class="container">
    
    <h1>PDF Finder</h1> <div class="key-manager">
        <span>Current List: <strong>{{ user_key }}</strong></span>
        <div class="key-inputs">
            <input type="text" id="user-key-input" placeholder="Enter key (e.g. 'jakub_list')" value="{{ user_key if user_key != 'public' }}">
            <button onclick="updateUserKey()" class="key-btn">Load List</button>
        </div>
    </div>
    
    <form id="form" method="post" enctype="multipart/form-data">
        <input type="text" name="query" placeholder="Enter search term" value="{{ query }}">

        <div class="drop-zone" id="drop-zone">
            Drop image here or click to upload<br>
        </div>

        <input type="file" name="image" id="image-input" style="display:none;" accept="image/*">

        <img id="preview" class="preview" />

        <button type="submit">Search</button>
    </form>

    {% if pdfs %}
    <div class="search-results">
        <h3>Search Results</h3>
        <div class="results-list">
            {% for pdf in pdfs %}
                <div class="pdf-link">
                    <a href="{{ pdf }}" target="_blank">{{ pdf }}</a>
                    <button class="favorite-btn" onclick="addFavorite('{{ pdf }}', this)">
                        â™¡
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
    {% elif query or (pdfs is not none and not results_found) %}
    <div class="search-results">
        <p class="no-results-message"> Nothing was found for your search query. Try different keywords or a clearer image.</p>
    </div>
    {% endif %}

    <div class="favorites-section">
        <h3>Your Favorites ({{ user_key }}):</h3>
        {% if favorites %}
            <div class="favorites-list">
                {% for favorite in favorites %}
                    <div class="favorite-item">
                        <a href="{{ favorite[0] }}" target="_blank">{{ favorite[0] }}</a>
                        <small>
                            Saved: {{ favorite[1] }}
                            <button class="remove-btn" onclick="removeFavoriteFromFavoritesSection('{{ favorite[0] }}')">Remove</button>
                        </small>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-favorites-message">No favorites yet for this list. Click the "Favorite" button next to PDF links to save them here.</p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".pdf-link a").forEach(link => {
        link.addEventListener("click", () => {
            fetch("/api/click", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ link_url: link.href })
            });
        });
    });
});
</script>

<script src="/static/js/main.js"></script>
</body>
</html>